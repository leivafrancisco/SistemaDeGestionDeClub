================================================================================
              RESUMEN DE MODIFICACIONES AL DIAGRAMA UML
================================================================================

Este documento detalla las diferencias entre el diagrama UML original
proporcionado y el diagrama actualizado basado en la implementaci√≥n real
del backend.

================================================================================
1. CAMBIOS EN LA ENTIDAD "ROL"
================================================================================

DIAGRAMA ORIGINAL:
  +crearRol(nombre) : void
  +actualizarRol(nombre) : void
  +eliminarRol() : void

DIAGRAMA ACTUALIZADO:
  [Sin m√©todos - entidad de solo datos]
  +id: int
  +nombre: string
  +fechaCreacion: DateTime
  +fechaActualizacion: DateTime
  +fechaEliminacion: DateTime?

RAZ√ìN DEL CAMBIO:
  ‚úì Los roles son datos semilla en la base de datos
  ‚úì No hay servicio RolService implementado
  ‚úì Los roles se gestionan directamente en la BD
  ‚úì Agregados campos de auditor√≠a (creaci√≥n, actualizaci√≥n, eliminaci√≥n)

================================================================================
2. CAMBIOS EN LA ENTIDAD "PERSONA"
================================================================================

DIAGRAMA ORIGINAL:
  +dni: string
  +fecha_nacimiento: date
  +registrar() : void
  +modificar(datos) : void
  +eliminar() : void

DIAGRAMA ACTUALIZADO:
  +dni: string
  +fechaNacimiento: DateTime
  +fechaCreacion: DateTime
  +fechaActualizacion: DateTime
  +fechaEliminacion: DateTime?
  +NombreCompleto: string [propiedad calculada]
  [Sin m√©todos propios]

RAZ√ìN DEL CAMBIO:
  ‚úì Persona es gestionada indirectamente a trav√©s de Socio y Usuario
  ‚úì No hay PersonaService independiente
  ‚úì Agregada propiedad calculada NombreCompleto
  ‚úì Agregados campos de auditor√≠a

================================================================================
3. CAMBIOS EN LA ENTIDAD "USUARIO"
================================================================================

DIAGRAMA ORIGINAL:
  +registrar() : void
  +cambiarContrasena(passActual, passNuevo) : void
  +activar() : void
  +desactivar() : void

DIAGRAMA ACTUALIZADO:
  +idPersona: int
  +idRol: int
  +nombreUsuario: string
  +contrasenaHash: string
  +estaActivo: bool
  +fechaCreacion: DateTime
  +fechaActualizacion: DateTime
  +fechaEliminacion: DateTime?
  +CrearAsync(dto, rolCreador) UsuarioDetalleDto
  +ObtenerPorIdAsync(id) UsuarioDetalleDto
  +ObtenerTodosAsync(rol, estaActivo) List<UsuarioDetalleDto>
  +ActualizarAsync(id, dto) UsuarioDetalleDto
  +DesactivarAsync(id) bool

RAZ√ìN DEL CAMBIO:
  ‚úì M√©todos reflejan UsuarioService.cs real
  ‚úì No existe cambiarContrasena implementado
  ‚úì activar/desactivar consolidados en DesactivarAsync
  ‚úì Agregados FKs (idPersona, idRol)
  ‚úì Agregados campos de auditor√≠a
  ‚úì Firma de m√©todos refleja implementaci√≥n async con DTOs

FUNCIONALIDADES NUEVAS:
  ‚úì CrearAsync con validaci√≥n de permisos por rol
    (admin crea recepcionistas, superadmin crea admin/recepcionistas)

================================================================================
4. CAMBIOS EN LA ENTIDAD "SOCIO"
================================================================================

DIAGRAMA ORIGINAL:
  +numero_socio: string
  +esta_activo: bool
  +fecha_alta: date
  +fecha_baja: date
  +registrar() : void
  +darAlta() : void
  +darBaja() : void
  +consultarEstado() : bool

DIAGRAMA ACTUALIZADO:
  +idPersona: int
  +numeroSocio: string [auto-generado]
  +estaActivo: bool
  +fechaAlta: DateTime
  +fechaBaja: DateTime?
  +fechaCreacion: DateTime
  +fechaActualizacion: DateTime
  +fechaEliminacion: DateTime?
  +CrearAsync(dto) SocioDetalleDto
  +ObtenerPorIdAsync(id) SocioDetalleDto
  +ObtenerTodosAsync(filtros) List<SocioDto>
  +ActualizarAsync(id, dto) SocioDetalleDto
  +DesactivarAsync(id) bool
  +ContarTotalAsync() int

RAZ√ìN DEL CAMBIO:
  ‚úì M√©todos reflejan SocioService.cs real
  ‚úì numeroSocio se auto-genera (SOC-0001, SOC-0002...)
  ‚úì darAlta/darBaja consolidados en CrearAsync/DesactivarAsync
  ‚úì consultarEstado es propiedad estaActivo
  ‚úì Agregados FK y campos de auditor√≠a
  ‚úì Agregado m√©todo de conteo

FUNCIONALIDADES NUEVAS:
  ‚úì Auto-generaci√≥n de n√∫mero de socio
  ‚úì B√∫squeda avanzada con filtros
  ‚úì Paginaci√≥n en listados

================================================================================
5. CAMBIOS EN LA ENTIDAD "ACTIVIDAD"
================================================================================

DIAGRAMA ORIGINAL:
  +nombre: string
  +descripcion: string
  +precio: decimal
  +es_cuota_base: bool ‚Üê ELIMINADO
  +registrarActividad(nombre, precio) : void
  +actualizarPrecio(precio) : void
  +esActividadBase() : bool

DIAGRAMA ACTUALIZADO:
  +nombre: string
  +descripcion: string
  +precio: decimal
  +fechaCreacion: DateTime
  +fechaActualizacion: DateTime
  +fechaEliminacion: DateTime?
  +ObtenerTodas() List<ActividadDto>
  +ObtenerPorId(id) ActividadDto
  +Crear(dto) ActividadDto
  +Actualizar(id, dto) ActividadDto
  +Eliminar(id) bool

RAZ√ìN DEL CAMBIO:
  ‚úì ELIMINADO: Campo "es_cuota_base" (ya no existe)
  ‚úì M√©todos reflejan ActividadService.cs real
  ‚úì actualizarPrecio incluido en Actualizar gen√©rico
  ‚úì esActividadBase eliminado (todas son iguales)
  ‚úì Agregados campos de auditor√≠a

================================================================================
6. CAMBIOS EN LA ENTIDAD "MEMBRESIA"
================================================================================

DIAGRAMA ORIGINAL:
  +periodo_anio: int ‚Üê ELIMINADO
  +periodo_mes: int ‚Üê ELIMINADO
  +fecha_inicio: date
  +fecha_fin: date
  +registrar() : void
  +finalizar() : void
  +calcularMonto() decimal

DIAGRAMA ACTUALIZADO:
  +idSocio: int
  +fechaInicio: DateTime ‚Üê AHORA ES EL CAMPO PRINCIPAL
  +fechaFin: DateTime ‚Üê AHORA ES EL CAMPO PRINCIPAL
  +fechaCreacion: DateTime
  +fechaActualizacion: DateTime
  +fechaEliminacion: DateTime?
  +TotalCargado: decimal [calculado]
  +TotalPagado: decimal [calculado]
  +Saldo: decimal [calculado]
  +ObtenerTodosAsync(filtros) List<MembresiaDto>
  +ObtenerPorIdAsync(id) MembresiaDto
  +CrearAsync(dto) MembresiaDto
  +ActualizarAsync(id, dto) MembresiaDto
  +EliminarAsync(id) bool
  +AsignarActividadAsync(dto) MembresiaDto
  +RemoverActividadAsync(dto) MembresiaDto
  +ContarTotalAsync() int

RAZ√ìN DEL CAMBIO:
  ‚úì ELIMINADO: periodo_anio y periodo_mes
  ‚úì Ahora usa fechaInicio y fechaFin como campos principales
  ‚úì Permite membres√≠as de cualquier duraci√≥n (no solo mensuales)
  ‚úì M√©todos reflejan MembresiaService.cs real
  ‚úì calcularMonto ahora son 3 propiedades calculadas
  ‚úì finalizar no existe (se usa soft delete)
  ‚úì Agregados m√©todos de gesti√≥n de actividades

FUNCIONALIDADES NUEVAS:
  ‚úì Validaci√≥n de solapamiento de fechas (no solo per√≠odo)
  ‚úì Asignar/remover actividades din√°micamente
  ‚úì Propiedades calculadas para totales y saldo

NOTA IMPORTANTE:
  Esta fue una migraci√≥n mayor realizada el 28/11/2025
  Script de migraci√≥n: migration-membresias-fechas.sql

================================================================================
7. CAMBIOS EN LA ENTIDAD "MEMBRESIA_ACTIVIDAD"
================================================================================

DIAGRAMA ORIGINAL:
  +precio_al_momento: decimal
  +agregarActividad(id_actividad) : void
  +quitarActividad(id_actividad) : void

DIAGRAMA ACTUALIZADO:
  +idMembresia: int (PK)
  +idActividad: int (PK)
  +precioAlMomento: decimal
  [Sin m√©todos propios]

RAZ√ìN DEL CAMBIO:
  ‚úì Es una entidad de asociaci√≥n (tabla intermedia)
  ‚úì agregar/quitar se manejan en MembresiaService
  ‚úì Agregados campos PK compuestos
  ‚úì Captura snapshot de precio hist√≥rico

================================================================================
8. CAMBIOS EN LA ENTIDAD "METODO_PAGO"
================================================================================

DIAGRAMA ORIGINAL:
  +nombre: string
  +agregarMetodo(nombre) : void
  +modificarMetodo(nombre) : void

DIAGRAMA ACTUALIZADO:
  +id: int
  +nombre: string (unique)
  [Sin m√©todos - entidad de solo datos]

RAZ√ìN DEL CAMBIO:
  ‚úì M√©todos de pago se gestionan directamente en BD
  ‚úì No hay servicio MetodoPagoService
  ‚úì Son datos de configuraci√≥n del sistema

================================================================================
9. CAMBIOS EN LA ENTIDAD "PAGO"
================================================================================

DIAGRAMA ORIGINAL:
  +monto: decimal
  +fecha_pago: date
  +registrarPago(monto, metodo) : void
  +calcularDescuento() decimal

DIAGRAMA ACTUALIZADO:
  +idMembresia: int
  +idMetodoPago: int
  +idUsuarioProcesa: int?
  +monto: decimal
  +fechaPago: DateTime
  +fechaCreacion: DateTime
  +fechaActualizacion: DateTime
  +fechaEliminacion: DateTime?
  +RegistrarAsync(dto) ComprobantePagoDto
  +ObtenerPorIdAsync(id) PagoDetalleDto
  +ObtenerTodosAsync(filtros) List<PagoDto>
  +GenerarComprobanteAsync(id) ComprobantePagoDto
  +AnularAsync(id) bool
  +ObtenerMetodosPagoAsync() List<MetodoPagoDto>
  +ObtenerEstadisticasAsync(filtros) EstadisticasPagosDto

RAZ√ìN DEL CAMBIO:
  ‚úì M√©todos reflejan PagoService.cs real
  ‚úì calcularDescuento NO existe (no hay descuentos)
  ‚úì Agregados FKs (idMembresia, idMetodoPago, idUsuarioProcesa)
  ‚úì Agregados campos de auditor√≠a
  ‚úì RegistrarAsync genera comprobante autom√°ticamente

FUNCIONALIDADES NUEVAS:
  ‚úì Generaci√≥n de comprobantes (PAG-XXXXXX-YYYY)
  ‚úì Anulaci√≥n de pagos (soft delete)
  ‚úì Estad√≠sticas de pagos
  ‚úì Registro de usuario que procesa

================================================================================
10. CAMBIOS EN LA ENTIDAD "ASISTENCIA"
================================================================================

DIAGRAMA ORIGINAL:
  +fecha_hora_ingreso: datetime
  +registrarAsistencia(id_socio) : void

DIAGRAMA ACTUALIZADO:
  +idSocio: int
  +fechaHoraIngreso: DateTime
  +fechaCreacion: DateTime
  +fechaActualizacion: DateTime
  +fechaEliminacion: DateTime?
  [Sin m√©todos - funcionalidad b√°sica]

RAZ√ìN DEL CAMBIO:
  ‚úì Entidad simple de registro
  ‚úì No hay AsistenciaService completo implementado
  ‚úì Agregados FK y campos de auditor√≠a

================================================================================
11. CAMBIOS EN LAS RELACIONES
================================================================================

RELACIONES ACTUALIZADAS:
  Persona "1" -- "0..1" Usuario
    - Antes: "1" o-- "1"
    - Ahora: Una persona puede existir sin usuario

  Persona "1" -- "0..1" Socio
    - Antes: "1" o-- "1"
    - Ahora: Una persona puede existir sin ser socio

  Usuario "n" -- "1" Rol
    - Antes: "1" o-- "1"
    - Ahora: Muchos usuarios pueden tener el mismo rol

RELACIONES SIN CAMBIOS:
  ‚úì Socio "1" -- "0..*" Membresia
  ‚úì MetodoPago "1" -- "0..*" Pago
  ‚úì Membresia "1" -- "0..*" MembresiaActividad
  ‚úì Actividad "1" -- "0..*" MembresiaActividad
  ‚úì Membresia "1" -- "0..*" Pago
  ‚úì Usuario "1" -- "0..*" Pago (procesa)
  ‚úì Socio "1" -- "0..*" Asistencia

================================================================================
12. CONVENCIONES Y PATRONES AGREGADOS
================================================================================

SOFT DELETE:
  Todas las entidades incluyen:
    +fechaEliminacion: DateTime? (nullable)

  Permite:
    ‚úì Recuperaci√≥n de datos
    ‚úì Auditor√≠a completa
    ‚úì No romper integridad referencial

AUDITOR√çA:
  Todas las entidades incluyen:
    +fechaCreacion: DateTime (auto-generado)
    +fechaActualizacion: DateTime (auto-actualizado)

ASYNC/AWAIT:
  Todos los m√©todos de servicios son async:
    - Nomenclatura: NombreAsync
    - Retornan: Task<T>

DTOS:
  Los m√©todos retornan DTOs, no entidades:
    - CrearSocioDto (entrada)
    - SocioDetalleDto (salida)
    - SocioDto (lista)

================================================================================
13. CAMPOS AUTO-GENERADOS
================================================================================

NUMERO DE SOCIO:
  - Campo: Socio.numeroSocio
  - Formato: SOC-0001, SOC-0002, SOC-0003...
  - Generado en: SocioService.CrearAsync
  - NO incluir en CrearSocioDto

COMPROBANTE DE PAGO:
  - Formato: PAG-{id:6 d√≠gitos}-{a√±o}
  - Ejemplo: PAG-000123-2025
  - Generado en: PagoService.RegistrarAsync

================================================================================
14. RESUMEN DE CAMBIOS CR√çTICOS
================================================================================

ELIMINACIONES:
  ‚ùå Actividad.es_cuota_base
  ‚ùå Membresia.periodo_anio
  ‚ùå Membresia.periodo_mes
  ‚ùå Usuario.cambiarContrasena()
  ‚ùå Pago.calcularDescuento()

ADICIONES:
  ‚úÖ Soft delete en todas las entidades
  ‚úÖ Auditor√≠a (fechaCreacion, fechaActualizacion)
  ‚úÖ Propiedades calculadas (NombreCompleto, Totales, Saldo)
  ‚úÖ M√©todos async que reflejan servicios reales
  ‚úÖ DTOs como tipos de retorno
  ‚úÖ Validaciones de permisos por rol
  ‚úÖ Auto-generaci√≥n de n√∫meros

MODIFICACIONES:
  üîÑ Membres√≠a: De per√≠odo mensual a rango de fechas flexible
  üîÑ Usuario: Permisos granulares de creaci√≥n
  üîÑ Todos los m√©todos: Nomenclatura async + DTOs

================================================================================
15. ARCHIVOS DE REFERENCIA
================================================================================

DIAGRAMA ACTUALIZADO:
  üìÑ DiagramaClases.md

DOCUMENTACI√ìN COMPLETA:
  üìÑ README-ARQUITECTURA.txt

GU√çA DE DESARROLLO:
  üìÑ CLAUDE.md

MIGRACI√ìN DE BASE DE DATOS:
  üìÑ migration-membresias-fechas.sql

ESTE DOCUMENTO:
  üìÑ CAMBIOS-DIAGRAMA-UML.txt

================================================================================
FIN DEL DOCUMENTO
================================================================================

Fecha: 28 de noviembre de 2025
Versi√≥n: 1.2.0
Autor: Sistema actualizado autom√°ticamente
